
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Exam: Intermediate Level</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body class="bg-gray-100 font-sans text-gray-800">

    <div class="container mx-auto p-4 sm:p-8">
        <div id="quiz-container" class="bg-white p-6 sm:p-8 rounded-lg shadow-xl max-w-4xl mx-auto">
            <div class="sticky-header bg-white pb-4 rounded-lg flex flex-col sm:flex-row justify-between items-center mb-4">
                <h1 class="text-xl sm:text-2xl font-bold text-[#132b3d] mb-2 sm:mb-0">Exam - Level 2: Intermediate</h1>
                <div class="flex items-center space-x-4">
                    <p class="text-md font-medium text-[#132b3d]">Questions Answered: <span id="answered-count">0</span> / 30</p>
                    <button onclick="restartQuiz()" class="bg-red-500 hover:bg-red-600 text-white font-semibold py-2 px-4 rounded-lg transition-colors">Restart Exam</button>
                    <a href="index.html" class="bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 px-4 rounded-lg transition-colors no-underline">Change Level</a>
                </div>
            </div>
            
            <div id="questions-list" class="space-y-8"></div>

            <div class="mt-10 text-center">
                <button id="submit-btn" class="submit-btn bg-[#f37e21] text-white font-bold py-4 px-12 rounded-full hover:bg-orange-600 transition-all transform hover:scale-105" disabled>
                    Submit Exam
                </button>
            </div>
        </div>

        <div id="scorecard-container" class="hidden bg-white p-6 sm:p-8 rounded-lg shadow-xl mt-8 max-w-4xl mx-auto">
            <h2 class="text-3xl sm:text-4xl font-bold text-center text-[#132b3d] mb-4">Your Results</h2>
            <div class="flex flex-col md:flex-row items-center justify-center gap-8 mb-8">
                <div class="w-48 h-48">
                    <canvas id="score-chart"></canvas>
                </div>
                <div class="text-center md:text-left">
                    <p class="text-lg text-[#818181]">You answered</p>
                    <p class="text-6xl font-extrabold text-[#132b3d]"><span id="score"></span>/<span id="total-questions-score"></span></p>
                    <p class="text-lg text-[#818181]">questions correctly.</p>
                </div>
            </div>
            <div id="scorecard-details" class="space-y-6"></div>
            <div class="mt-8 text-center">
                <a href="index.html" class="bg-[#f37e21] text-white font-bold py-3 px-8 rounded-full hover:bg-orange-600 transition-all transform hover:scale-105 no-underline">
                    Back to Level Select
                </a>
            </div>
        </div>
    </div>

    <script>
        const quizData = [
            {id:51,question:"Which GA4 report helps identify which campaigns or sources bring engaged sessions?",options:["Demographics","Engagement → Events","Acquisition → Traffic Acquisition","Monetization"],answer:"Acquisition → Traffic Acquisition",explanation:"Traffic Acquisition report shows sessions/users by source, medium, campaign, and engagement."},
            {id:52,question:"What is the recommended way to capture user login status in GA4?",options:["Use GA4 default event","Use a Custom Dimension mapped to a parameter","Add as a User Property only","Track as a Page View"],answer:"Use a Custom Dimension mapped to a parameter",explanation:"Login status must be passed as a parameter → registered as a Custom Dimension for reporting."},
            {id:53,question:"In GTM, which trigger is best for tracking form submissions?",options:["Page View Trigger","Click Trigger","Form Submission Trigger","DOM Ready Trigger"],answer:"Form Submission Trigger",explanation:"GTM has a built-in Form Submission trigger that listens to form events."},
            {id:54,question:"Which GA4 parameter measures the time between first and last user interaction in a session?",options:["engagement_time_msec","session_duration","elapsed_time","user_lifetime"],answer:"session_duration",explanation:"GA4 uses session_duration to calculate time spent per session."},
            {id:55,question:"In server-side tagging, what is a key benefit of using a custom domain for the tagging server?",options:["Reduces costs","Improves tracking accuracy by bypassing ad-blockers","Allows offline tracking","Eliminates cookies completely"],answer:"Improves tracking accuracy by bypassing ad-blockers",explanation:"Using a custom domain for your server endpoint makes tracking harder to block by filters."},
            {id:56,question:"Which GTM feature ensures that a tag fires only once per page load?",options:["Blocking Triggers","Once-per-page firing option","Tag Sequencing","Custom JavaScript Variable"],answer:"Once-per-page firing option",explanation:"In tag settings, you can configure a tag to fire only once per page."},
            {id:57,question:"What is the default session timeout in GA4?",options:["15 minutes","30 minutes","60 minutes","24 hours"],answer:"30 minutes",explanation:"By default, GA4 sessions timeout after 30 minutes of inactivity."},
            {id:58,question:"Which consent type in GTM controls Google Ads remarketing cookies?",options:["analytics_storage","ad_storage","personalization_storage","marketing_storage"],answer:"ad_storage",explanation:"ad_storage consent controls remarketing and advertising cookies."},
            {id:59,question:"If a GA4 event does not appear in DebugView, but the GTM Preview shows it firing, what is the likely issue?",options:["Tag Sequencing error","Wrong Measurement ID in GA4 Configuration","Missing trigger in GTM","Consent not implemented"],answer:"Wrong Measurement ID in GA4 Configuration",explanation:"If GTM shows tag firing but GA4 does not receive the event, it’s often a misconfigured Measurement ID."},
            {id:60,question:"Which of these is NOT a recommended way to implement cookie consent in GTM?",options:["Blocking triggers","Consent Initialization","Tag Sequencing","Server Logs"],answer:"Server Logs",explanation:"Cookie consent should be handled at the tag/trigger level, not via server logs."},
            {id:61,question:"What is the maximum number of GA4 custom metrics per property?",options:["25","50","100","Unlimited"],answer:"50",explanation:"GA4 allows up to 50 custom metrics per property."},
            {id:62,question:"Which GA4 scope is used when you register a User Property?",options:["Event scope","Session scope","User scope","Hit scope"],answer:"User scope",explanation:"User Properties apply at the user level, persisting across sessions."},
            {id:63,question:"What is the role of the “Transport URL” in server-side tagging?",options:["Encrypts GA4 data","Defines the custom endpoint for event collection","Configures cookie consent","Stores user IDs"],answer:"Defines the custom endpoint for event collection",explanation:"The Transport URL points GA4/GTM requests to your server-side endpoint."},
            {id:64,question:"Which GA4 event is recommended for tracking when a user begins checkout?",options:["purchase","add_to_cart","begin_checkout","select_item"],answer:"begin_checkout",explanation:"begin_checkout is the recommended GA4 event for checkout initiation."},
            {id:65,question:"What is the key advantage of using GTM variables inside triggers?",options:["Prevents tag duplication","Makes triggers dynamic and flexible","Blocks consent checks","Simplifies GA4 setup"],answer:"Makes triggers dynamic and flexible",explanation:"Variables allow triggers to adapt based on dynamic values like URLs or click text."},
            {id:66,question:"Which GA4 dimension measures if a user is new or returning?",options:["engagement_type","session_source","new_vs_returning","user_pseudo_id"],answer:"new_vs_returning",explanation:"GA4 has a built-in New/Returning user dimension."},
            {id:67,question:"Which GTM tag type is used to deploy consent banners from third-party tools?",options:["GA4 Event tag","Custom HTML tag","Constant Variable","DOM Ready tag"],answer:"Custom HTML tag",explanation:"Most consent banner scripts are added via Custom HTML tags in GTM."},
            {id:68,question:"In GA4, what is the default lookback window for attribution reporting?",options:["7 days","30 days","90 days","120 days"],answer:"30 days",explanation:"GA4 attribution reporting uses a 30-day lookback window by default (configurable)."},
            {id:69,question:"Which GA4 metric measures the percentage of sessions that were not engaged?",options:["Bounce Rate","Exit Rate","Churn Rate","Drop-off"],answer:"Bounce Rate",explanation:"In GA4, Bounce Rate is the percentage of sessions that were not engaged."},
            {id:70,question:"Which GTM trigger is best for firing a tag on specific URLs only?",options:["All Pages","Page View with URL Condition","DOM Ready","Custom Event"],answer:"Page View with URL Condition",explanation:"You can restrict Page View triggers with conditions on URL or path."},
            {id:71,question:"Which GA4 event is automatically collected when a user clicks a link that leads outside the domain?",options:["file_download","outbound_click","external_link","exit_page"],answer:"outbound_click",explanation:"GA4 auto-collects outbound_click events."},
            {id:72,question:"What is the best way to debug server-side tagging requests?",options:["GA4 Reports","Server Container Debug Mode","Data Studio","Consent Logs"],answer:"Server Container Debug Mode",explanation:"GTM server containers include a debug view for validating requests."},
            {id:73,question:"In GA4, which metric is considered a session quality metric?",options:["Engagement Rate","Bounce Rate","Average Order Value","User Lifetime Value"],answer:"Engagement Rate",explanation:"GA4 uses Engagement Rate instead of bounce rate as a positive quality metric."},
            {id:74,question:"What does the GA4 parameter items contain in ecommerce events?",options:["Total revenue","List of products with attributes","Transaction ID","User ID"],answer:"List of products with attributes",explanation:"items is an array containing product details (ID, name, price, quantity, etc.)."},
            {id:75,question:"Which GTM feature ensures a tag fires after consent is granted?",options:["Tag Sequencing","Consent Checks","Trigger Group","Blocking Trigger"],answer:"Consent Checks",explanation:"GTM’s Consent Checks validate user consent before firing a tag."},
            {id:76,question:"Which GA4 feature helps create groups of users for remarketing?",options:["Segments","Audiences","Explorations","Funnels"],answer:"Audiences",explanation:"Audiences in GA4 are used for remarketing and targeting in Google Ads."},
            {id:77,question:"Which server-side tagging method helps minimize duplicate purchases?",options:["Deduplication logic in server container","Cookie consent enforcement","Data Layer push","GTM Tag Sequencing"],answer:"Deduplication logic in server container",explanation:"Server-side containers can apply deduplication rules for events like purchases."},
            {id:78,question:"Which GA4 consent mode allows only pseudonymous data collection without cookies?",options:["analytics_storage = \"granted\"","analytics_storage = \"denied\"","ad_storage = \"granted\"","personalization_storage = \"denied\""],answer:"analytics_storage = \"denied\"",explanation:"With analytics_storage=denied, GA4 collects only pseudonymous data (no cookies)."},
            {id:79,question:"In GTM, which variable type would you use to extract the text of a clicked button?",options:["Data Layer Variable","DOM Element Variable","Click Text Variable","Constant Variable"],answer:"Click Text Variable",explanation:"GTM has a Click Text variable to capture button/link text."},
            {id:80,question:"What is the key benefit of using server-side tagging for GA4?",options:["Eliminates need for consent banners","Provides better control over data, privacy, and attribution accuracy","Reduces GTM container size","Speeds up GA4 reporting"],answer:"Provides better control over data, privacy, and attribution accuracy",explanation:"Server-side tagging ensures data quality, privacy compliance, and better attribution handling."}
        ];

        const currentLevel = 'intermediate';
        let userAnswers = {};
        let scoreChart = null;
        const userAnswersKey = `exam_user_answers_${currentLevel}`;
        const alphabet = ['A', 'B', 'C', 'D'];

        function restartQuiz() {
            if (confirm('Are you sure you want to restart this exam? Your progress will be lost.')) {
                userAnswers = {};
                localStorage.removeItem(userAnswersKey);
                document.getElementById('answered-count').innerText = 0;
                renderQuestions();
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        }

        function renderQuestions() {
            const questionsContainer = document.getElementById('questions-list');
            questionsContainer.innerHTML = '';
            quizData.forEach((q, index) => {
                const questionElement = document.createElement('div');
                questionElement.className = 'p-6 border border-[#818181] rounded-lg bg-white shadow-sm transition-transform duration-300 hover:scale-[1.01]';
                questionElement.id = `question-card-${q.id}`;
                questionElement.innerHTML = `
                    <p class="font-bold text-lg mb-4 text-[#132b3d]">${index + 1}. ${q.question}</p>
                    <div class="space-y-3">
                        ${q.options.map((option, optIndex) => `
                            <label class="block question-option p-3 rounded-md bg-gray-50 hover:bg-gray-200">
                                <input type="radio" name="question-${q.id}" value="${option}" class="hidden">
                                <span class="ml-2 font-medium">${alphabet[optIndex]}. ${option}</span>
                            </label>
                        `).join('')}
                    </div>
                `;
                questionsContainer.appendChild(questionElement);
            });
            loadProgress();

            document.querySelectorAll('input[type="radio"]').forEach(input => {
                input.addEventListener('change', (e) => {
                    const questionId = e.target.name.split('-')[1];
                    userAnswers[questionId] = e.target.value;
                    const questionCard = document.getElementById(`question-card-${questionId}`);
                    questionCard.classList.add('question-answered');

                    const labels = questionCard.querySelectorAll('label');
                    labels.forEach(label => {
                        label.classList.remove('option-selected');
                    });
                    e.target.closest('label').classList.add('option-selected');
                    
                    saveProgress();
                });
            });
        }

        function loadProgress() {
            const savedAnswers = localStorage.getItem(userAnswersKey);
            if (savedAnswers) {
                userAnswers = JSON.parse(savedAnswers);
                let answeredCount = 0;
                for (const qId in userAnswers) {
                    const questionCard = document.getElementById(`question-card-${qId}`);
                    if (questionCard) {
                        questionCard.classList.add('question-answered');
                        const input = document.querySelector(`input[name="question-${qId}"][value="${userAnswers[qId]}"]`);
                        if (input) {
                            input.checked = true;
                            input.closest('label').classList.add('option-selected');
                        }
                        answeredCount++;
                    }
                }
                document.getElementById('answered-count').innerText = answeredCount;
            } else {
                 userAnswers = {};
                 document.getElementById('answered-count').innerText = 0;
            }
            checkAllAnswered();
        }

        function saveProgress() {
            localStorage.setItem(userAnswersKey, JSON.stringify(userAnswers));
            document.getElementById('answered-count').innerText = Object.keys(userAnswers).length;
            checkAllAnswered();
        }

        function checkAllAnswered() {
            const allAnswered = Object.keys(userAnswers).length === quizData.length;
            document.getElementById('submit-btn').disabled = !allAnswered;
        }

        function submitQuiz() {
            let score = 0;
            quizData.forEach(q => {
                if (userAnswers[q.id] === q.answer) {
                    score++;
                }
            });

            document.getElementById('quiz-container').classList.add('hidden');
            document.getElementById('scorecard-container').classList.remove('hidden');
            document.getElementById('score').innerText = score;
            document.getElementById('total-questions-score').innerText = quizData.length;

            renderScorecard();
            renderScoreChart(score);
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function renderScorecard() {
            const detailsContainer = document.getElementById('scorecard-details');
            detailsContainer.innerHTML = '';
            quizData.forEach((q, index) => {
                const userAnswer = userAnswers[q.id];
                const isCorrect = userAnswer === q.answer;

                const questionResult = document.createElement('div');
                questionResult.className = `p-6 rounded-lg shadow-md transition-transform duration-300 transform hover:scale-[1.01] bg-white`;

                let optionsHTML = q.options.map((option, optIndex) => {
                    let classes = 'block mt-2 p-3 rounded-md';
                    if (option === q.answer) {
                        classes += ' bg-green-100 text-green-800 border border-green-400 font-bold';
                    } else if (option === userAnswer && !isCorrect) {
                        classes += ' bg-red-100 text-red-800 border border-red-400 font-bold';
                    } else {
                         classes += ' bg-gray-100 text-gray-800 border border-transparent';
                    }
                    return `<div class="${classes}">${alphabet[optIndex]}. ${option}</div>`;
                }).join('');

                questionResult.innerHTML = `
                    <p class="font-bold text-lg mb-4 text-[#132b3d]">${index + 1}. ${q.question}</p>
                    <div class="space-y-2">
                        ${optionsHTML}
                    </div>
                    <div class="mt-6 p-4 bg-gray-100 rounded-md">
                        <p class="font-bold text-[#132b3d] mb-1">Explanation:</p>
                        <p class="text-gray-700">${q.explanation}</p>
                    </div>
                `;
                detailsContainer.appendChild(questionResult);
            });
        }

        function renderScoreChart(score) {
            const ctx = document.getElementById('score-chart').getContext('2d');
            if (scoreChart) {
                scoreChart.destroy();
            }
            scoreChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Correct', 'Incorrect'],
                    datasets: [{
                        data: [score, quizData.length - score],
                        backgroundColor: ['#108289', '#f37e21'],
                        hoverOffset: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '70%',
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }

        document.addEventListener('DOMContentLoaded', () => {
            renderQuestions();
            document.getElementById('submit-btn').addEventListener('click', submitQuiz);
        });
    </script>
</body>
</html>
