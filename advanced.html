
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Exam: Advanced Level</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body class="bg-gray-100 font-sans text-gray-800">

    <div class="container mx-auto p-4 sm:p-8">
        <div id="quiz-container" class="bg-white p-6 sm:p-8 rounded-lg shadow-xl max-w-4xl mx-auto">
            <div class="sticky-header bg-white pb-4 rounded-lg flex flex-col sm:flex-row justify-between items-center mb-4">
                <h1 class="text-xl sm:text-2xl font-bold text-[#132b3d] mb-2 sm:mb-0">Exam - Level 3: Advanced</h1>
                <div class="flex items-center space-x-4">
                    <p class="text-md font-medium text-[#132b3d]">Questions Answered: <span id="answered-count">0</span> / 50</p>
                    <button onclick="restartQuiz()" class="bg-red-500 hover:bg-red-600 text-white font-semibold py-2 px-4 rounded-lg transition-colors">Restart Exam</button>
                    <a href="index.html" class="bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 px-4 rounded-lg transition-colors no-underline">Change Level</a>
                </div>
            </div>
            
            <div id="questions-list" class="space-y-8"></div>

            <div class="mt-10 text-center">
                <button id="submit-btn" class="submit-btn bg-[#f37e21] text-white font-bold py-4 px-12 rounded-full hover:bg-orange-600 transition-all transform hover:scale-105" disabled>
                    Submit Exam
                </button>
            </div>
        </div>

        <div id="scorecard-container" class="hidden bg-white p-6 sm:p-8 rounded-lg shadow-xl mt-8 max-w-4xl mx-auto">
            <h2 class="text-3xl sm:text-4xl font-bold text-center text-[#132b3d] mb-4">Your Results</h2>
            <div class="flex flex-col md:flex-row items-center justify-center gap-8 mb-8">
                <div class="w-48 h-48">
                    <canvas id="score-chart"></canvas>
                </div>
                <div class="text-center md:text-left">
                    <p class="text-lg text-[#818181]">You answered</p>
                    <p class="text-6xl font-extrabold text-[#132b3d]"><span id="score"></span>/<span id="total-questions-score"></span></p>
                    <p class="text-lg text-[#818181]">questions correctly.</p>
                </div>
            </div>
            <div id="scorecard-details" class="space-y-6"></div>
            <div class="mt-8 text-center">
                <a href="index.html" class="bg-[#f37e21] text-white font-bold py-3 px-8 rounded-full hover:bg-orange-600 transition-all transform hover:scale-105 no-underline">
                    Back to Level Select
                </a>
            </div>
        </div>
    </div>

    <script>
        const quizData = [
            {id:101,question:"A business reports duplicate purchase events in GA4. They are using both GA4 eCommerce events from the website and GA4 purchase events forwarded via server-side tagging. What’s the best solution?",options:["Disable GA4 client in server container","Implement event deduplication with transaction_id","Block client-side events completely","Use only session_id"],answer:"Implement event deduplication with transaction_id",explanation:"GA4 uses the transaction_id parameter for deduplication. Both client and server events should pass the same transaction ID so duplicates are ignored."},
            {id:102,question:"You need to measure scroll depth tracking only after users give cookie consent. How should this be implemented?",options:["Trigger scroll event unconditionally","Use Consent Mode with analytics_storage=’granted’","Use server-side tagging only","Manually filter scroll events in GA4"],answer:"Use Consent Mode with analytics_storage=’granted’",explanation:"By binding scroll event tags to Consent Mode, GA4 only stores data when consent is granted."},
            {id:103,question:"If a GA4 DebugView shows delayed event appearances, what is the likely cause?",options:["Wrong Measurement ID","Debug Mode not enabled","Using server-side tagging which introduces latency","GA4 property misconfigured"],answer:"Using server-side tagging which introduces latency",explanation:"Server-side tagging introduces a slight delay since events route through the server before GA4 receives them."},
            {id:104,question:"An eCommerce site wants to track coupon usage in GA4. Which parameter should be used?",options:["coupon_applied","promotion_id","coupon","discount_code"],answer:"coupon",explanation:"GA4 has a standard eCommerce parameter coupon for tracking promo code usage."},
            {id:105,question:"A GTM tag fires multiple times for the same event. Which debugging step should you take first?",options:["Add a blocking trigger","Check trigger conditions in Preview mode","Clear GTM cache","Change Measurement ID"],answer:"Check trigger conditions in Preview mode",explanation:"Duplicate firing usually occurs due to overly broad trigger conditions, best diagnosed via GTM preview/debug."},
            {id:106,question:"If you want to enrich GA4 events with first-party CRM data via server-side tagging, where should you map this data?",options:["GTM client","Event Data transformation in server container","Consent Initialization tag","GA4 event settings"],answer:"Event Data transformation in server container",explanation:"Server containers allow you to transform/enrich event payloads before forwarding to GA4."},
            {id:107,question:"Which consent mode setting ensures that Google Ads remarketing cookies are only set after user agreement?",options:["analytics_storage","ad_storage","personalization_storage","functional_storage"],answer:"ad_storage",explanation:"ad_storage consent flag controls whether Google Ads remarketing cookies can be set."},
            {id:108,question:"Which GA4 report is best to validate whether consent mode is reducing data volume?",options:["Engagement → Events","Advertising → Conversion Paths","Admin → Consent Debugger","Tech → Consent Overview"],answer:"Tech → Consent Overview",explanation:"GA4 has a Consent Overview report under Tech, showing how consent impacts data."},
            {id:109,question:"An eCommerce site wants to analyze refunds in GA4. Which event should they implement?",options:["refund","cancel_purchase","order_returned","transaction_refund"],answer:"refund",explanation:"GA4 has a standard event refund for returned/canceled purchases."},
            {id:110,question:"You see events firing in GTM Preview but not reaching GA4. The GA4 tag uses a server-side endpoint. What’s the likely issue?",options:["Wrong trigger","Server container not resolving custom domain","GA4 property disabled","Debug Mode not activated"],answer:"Server container not resolving custom domain",explanation:"If GTM fires but GA4 doesn’t log, the Transport URL / server domain may not be properly configured."},
            {id:111,question:"How does GA4’s data-driven attribution differ from last-click?",options:["Gives equal credit to all channels","Prioritizes first click","Distributes credit based on conversion influence across touchpoints","Focuses only on paid channels"],answer:"Distributes credit based on conversion influence across touchpoints",explanation:"Data-driven attribution (DDA) uses machine learning to credit channels proportionally based on their actual contribution."},
            {id:112,question:"In GTM server-side tagging, which client is responsible for processing GA4 hits?",options:["Universal Analytics Client","GA4 Client","HTTP API Client","Consent Client"],answer:"GA4 Client",explanation:"The GA4 Client parses incoming GA4 Measurement Protocol hits in the server container."},
            {id:113,question:"You’re asked to block tracking until a user accepts cookies. Which GTM feature should you use?",options:["Blocking triggers","Consent Initialization tag type","Trigger group","Tag sequencing"],answer:"Consent Initialization tag type",explanation:"Consent Initialization tags run early to control how other tags behave depending on consent."},
            {id:114,question:"An analyst notices missing purchases in GA4 when using server-side tagging. What’s the first troubleshooting step?",options:["Verify ecommerce schema in GTM","Check if GA4 Client in server container is active","Reinstall GTM","Shorten session timeout"],answer:"Check if GA4 Client in server container is active",explanation:"If purchases aren’t being logged, the GA4 Client in the server container may be misconfigured or missing."},
            {id:115,question:"Which GA4 dimension allows identifying cross-platform users if User-ID is implemented?",options:["user_pseudo_id","user_id","device_category","client_id"],answer:"user_id",explanation:"GA4’s User-ID feature links users across devices/platforms."},
            {id:116,question:"What happens when analytics_storage is denied but ad_storage is granted?",options:["Analytics cookies not stored, Ads cookies allowed","Ads cookies blocked, Analytics works","Both disabled","Consent ignored"],answer:"Analytics cookies not stored, Ads cookies allowed",explanation:"Consent Mode lets you granularly control storage for analytics vs ads separately."},
            {id:117,question:"A site uses SPA (Single Page Application). Why are History Change Triggers recommended in GTM?",options:["They prevent duplicate GA4 sessions","They track navigation without full page reloads","They bypass cookie consent","They automatically enrich GA4 data"],answer:"They track navigation without full page reloads",explanation:"SPAs don’t reload pages, so GTM History Change triggers detect virtual navigation events."},
            {id:118,question:"You observe inflated direct traffic in GA4 after enabling server-side tagging. What’s the likely issue?",options:["Incorrect consent mode setup","Missing referrer forwarding in server container","Wrong attribution model","Over-sampling"],answer:"Missing referrer forwarding in server container",explanation:"If referrer headers aren’t forwarded in server-side requests, GA4 mislabels traffic as direct."},
            {id:119,question:"What is the maximum number of GA4 audiences per property?",options:["50","100","200","Unlimited"],answer:"200",explanation:"GA4 allows 200 audiences per property."},
            {id:120,question:"A client complains that GA4 reports fewer users than expected after enabling Consent Mode. Why?",options:["GA4 sampling","Users declining consent reduces cookie-based tracking","Wrong Measurement ID","Debug Mode not used"],answer:"Users declining consent reduces cookie-based tracking",explanation:"Consent Mode limits tracking based on user choices → fewer users may be counted."},
            {id:121,question:"Which GTM feature ensures one tag runs only after another tag successfully fires?",options:["Trigger Groups","Blocking Trigger","Tag Sequencing","Lookup Table Variable"],answer:"Tag Sequencing",explanation:"Tag sequencing ensures execution order (e.g., GA4 config fires before event tags)."},
            {id:122,question:"In GA4, where do you configure a custom dimension for an event parameter?",options:["Tag Manager variable list","GA4 Admin → Custom Definitions","GA4 Reports → Explorations","Consent Initialization"],answer:"GA4 Admin → Custom Definitions",explanation:"GA4 requires you to register event parameters as custom dimensions before they appear in reports."},
            {id:123,question:"If a GA4 event parameter is not appearing in reports after setup, what is the most likely reason?",options:["Wrong property ID","Parameter not registered as a custom definition","Consent denied","GA4 session timeout"],answer:"Parameter not registered as a custom definition",explanation:"Custom parameters must be registered as custom dimensions/metrics in GA4."},
            {id:124,question:"When testing Consent Mode, which GA4 tool helps check whether consent signals are being respected?",options:["Consent Overview report","Realtime report","Audience Builder","Predictive Metrics"],answer:"Consent Overview report",explanation:"The Consent Overview report shows how tags behave based on user consent."},
            {id:125,question:"An analyst wants to track enhanced measurement scrolls only up to 75%. What should be configured?",options:["GA4 Admin → Event Modification","GTM custom trigger with Scroll Depth = 75%","GA4 DebugView filter","GA4 Audience filter"],answer:"GTM custom trigger with Scroll Depth = 75%",explanation:"GA4 enhanced scroll is fixed (90%). Custom scroll thresholds require GTM custom triggers."},
            {id:126,question:"Which GA4 feature allows you to analyze multi-step user journeys like checkout funnels?",options:["Path Exploration","Funnel Exploration","Cohort Exploration","Segments"],answer:"Funnel Exploration",explanation:"Funnel Exploration visualizes multi-step user journeys."},
            {id:127,question:"A GTM server-side container is deployed on collect.example.com. Why is this beneficial?",options:["Improves ad personalization","Makes tracking requests look like first-party","Automatically removes cookies","Increases GTM limits"],answer:"Makes tracking requests look like first-party",explanation:"Hosting the endpoint on a subdomain ensures requests are first-party, avoiding ITP cookie blocking."},
            {id:128,question:"Which GA4 report is best for investigating attribution modeling differences?",options:["User Explorer","Model Comparison Tool","Funnel Exploration","Path Exploration"],answer:"Model Comparison Tool",explanation:"The Model Comparison Tool allows testing different attribution models (last click, DDA, etc.)."},
            {id:129,question:"If GA4 ecommerce items array is missing, what will happen?",options:["Purchase events fail completely","Purchases are tracked without product details","GA4 reports break","GA4 stops sending data"],answer:"Purchases are tracked without product details",explanation:"GA4 logs the event, but ecommerce product detail reports will be empty."},
            {id:130,question:"In Consent Mode, when storage is denied, how does GA4 handle user data?",options:["No data collected","Data is modeled based on non-consented users","Limited pings sent without cookies","Only custom events are tracked"],answer:"Limited pings sent without cookies",explanation:"GA4 still sends cookieless pings to preserve modeling."},
            {id:131,question:"Which GTM feature would you use to capture a query string value from the URL (e.g., utm_source)?",options:["Auto-Event Variable","Lookup Table","URL Variable","Custom JavaScript"],answer:"URL Variable",explanation:"The URL Variable extracts query parameters like utm_source."},
            {id:132,question:"If a GA4 server-side container doesn’t log incoming requests, which tool helps check requests?",options:["Chrome DevTools → Network tab","GA4 DebugView","Consent Mode report","Admin Audit Log"],answer:"Chrome DevTools → Network tab",explanation:"Network tab helps verify whether events hit the server endpoint at all."},
            {id:133,question:"What’s the key difference between blocking triggers and exception triggers in GTM?",options:["Blocking triggers stop tags permanently, exceptions apply conditionally","Exceptions are tag-level, blocking are trigger-level","They are identical","Blocking only works for GA4 tags"],answer:"Exceptions are tag-level, blocking are trigger-level",explanation:"Exception triggers stop a tag, while blocking applies at trigger level."},
            {id:134,question:"Which GA4 feature can predict future purchase probability?",options:["Predictive Metrics","Funnel Exploration","BigQuery export","Modeled Conversions"],answer:"Predictive Metrics",explanation:"GA4’s predictive metrics estimate purchase and churn probability."},
            {id:135,question:"If GA4 events are received but revenue is always “0”, what’s missing?",options:["coupon parameter","value or items array","transaction_id","ad_storage consent"],answer:"value or items array",explanation:"Without value and items, GA4 cannot log revenue."},
            {id:136,question:"When debugging consent, which GTM variable shows current consent state?",options:["{{Consent State}}","{{Consent Default}}","{{Consent Mode}}","{{Consent Debugger}}"],answer:"{{Consent State}}",explanation:"GTM has a built-in Consent State variable."},
            {id:137,question:"What’s the default data retention period in GA4 for event-level data?",options:["2 months","14 months","26 months","50 months"],answer:"2 months",explanation:"GA4 defaults to 2 months, but can be extended to 14."},
            {id:138,question:"A server-side container is not enriching requests with IP/User-Agent. What’s missing?",options:["Client configuration","Header forwarding setup","Debug mode","Trigger group"],answer:"Header forwarding setup",explanation:"You must forward headers (IP, UA) for GA4 enrichment."},
            {id:139,question:"Which GA4 metric best evaluates engagement quality?",options:["Bounce rate","Engaged sessions","Session duration","Views per user"],answer:"Engaged sessions",explanation:"GA4 defines engaged sessions (10s+, conversion, or 2+ views)."},
            {id:140,question:"If GA4 purchase revenue is higher than actual, what’s likely wrong?",options:["Wrong coupon parameter","Duplicate transaction_ids not used","ad_storage misconfigured","Wrong audience setup"],answer:"Duplicate transaction_ids not used",explanation:"Without transaction_id, duplicate purchases can inflate revenue."},
            {id:141,question:"Which advanced technique allows splitting GTM container into multiple environments (dev, staging, prod)?",options:["Workspaces","Environments","Versions","Custom JS"],answer:"Environments",explanation:"GTM Environments let you test separate container setups."},
            {id:142,question:"GA4 sampling happens when using:",options:["Standard reports","BigQuery export","Explorations with large data","Realtime report"],answer:"Explorations with large data",explanation:"GA4 sampling applies only in Explorations, not standard reports."},
            {id:143,question:"Which GA4 event parameter is critical for ecommerce deduplication?",options:["session_id","transaction_id","user_id","coupon"],answer:"transaction_id",explanation:"transaction_id prevents duplicate purchase counting."},
            {id:144,question:"Which server-side tagging feature helps prevent ad blockers from blocking hits?",options:["Transport URL with custom domain","GA4 Debugger","Consent Initialization","Lookup Variables"],answer:"Transport URL with custom domain",explanation:"Using a custom domain bypasses common ad blocker filters."},
            {id:145,question:"If a GTM variable returns undefined values in Preview, what’s the best fix?",options:["Add Consent Initialization","Check trigger timing","Delete GA4 tag","Extend GA4 session"],answer:"Check trigger timing",explanation:"Variables may load too early, before DOM/data is ready."},
            {id:146,question:"Which GA4 event is automatically collected if enhanced measurement is on?",options:["video_start","video_progress","file_download","ad_click"],answer:"file_download",explanation:"File downloads are auto-tracked in enhanced measurement."},
            {id:147,question:"What’s the primary benefit of BigQuery export from GA4?",options:["More custom reports","Unsampled, raw event-level data","Free storage","Automated ads"],answer:"Unsampled, raw event-level data",explanation:"BigQuery export gives unsampled event-level data."},
            {id:148,question:"In cookie consent frameworks, which option describes prior consent?",options:["Tracking starts, then user opts out","Tracking waits until user opts in","Tracking always on","Consent ignored for analytics"],answer:"Tracking waits until user opts in",explanation:"Prior consent = no tracking until user actively agrees."},
            {id:149,question:"Which GTM tag type is used for sending data to GA4 via Measurement Protocol in server container?",options:["GA4 Event","GA4 Configuration","GA4 Server Event","HTTP Request"],answer:"GA4 Server Event",explanation:"GA4 Server Event tag sends data from server container to GA4."},
            {id:150,question:"A marketer notices GA4 reports low conversion numbers vs backend sales. What’s the first step?",options:["Check GA4 attribution model","Verify event schema matches GA4 ecommerce spec","Enable Predictive Metrics","Reduce data retention"],answer:"Verify event schema matches GA4 ecommerce spec",explanation:"If sales don’t match, ecommerce schema mismatch is the first thing to check."}
        ];

        const currentLevel = 'advanced';
        let userAnswers = {};
        let scoreChart = null;
        const userAnswersKey = `exam_user_answers_${currentLevel}`;
        const alphabet = ['A', 'B', 'C', 'D'];

        function restartQuiz() {
            if (confirm('Are you sure you want to restart this exam? Your progress will be lost.')) {
                userAnswers = {};
                localStorage.removeItem(userAnswersKey);
                document.getElementById('answered-count').innerText = 0;
                renderQuestions();
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        }

        function renderQuestions() {
            const questionsContainer = document.getElementById('questions-list');
            questionsContainer.innerHTML = '';
            quizData.forEach((q, index) => {
                const questionElement = document.createElement('div');
                questionElement.className = 'p-6 border border-[#818181] rounded-lg bg-white shadow-sm transition-transform duration-300 hover:scale-[1.01]';
                questionElement.id = `question-card-${q.id}`;
                questionElement.innerHTML = `
                    <p class="font-bold text-lg mb-4 text-[#132b3d]">${index + 1}. ${q.question}</p>
                    <div class="space-y-3">
                        ${q.options.map((option, optIndex) => `
                            <label class="block question-option p-3 rounded-md bg-gray-50 hover:bg-gray-200">
                                <input type="radio" name="question-${q.id}" value="${option}" class="hidden">
                                <span class="ml-2 font-medium">${alphabet[optIndex]}. ${option}</span>
                            </label>
                        `).join('')}
                    </div>
                `;
                questionsContainer.appendChild(questionElement);
            });
            loadProgress();

            document.querySelectorAll('input[type="radio"]').forEach(input => {
                input.addEventListener('change', (e) => {
                    const questionId = e.target.name.split('-')[1];
                    userAnswers[questionId] = e.target.value;
                    const questionCard = document.getElementById(`question-card-${questionId}`);
                    questionCard.classList.add('question-answered');

                    const labels = questionCard.querySelectorAll('label');
                    labels.forEach(label => {
                        label.classList.remove('option-selected');
                    });
                    e.target.closest('label').classList.add('option-selected');
                    
                    saveProgress();
                });
            });
        }

        function loadProgress() {
            const savedAnswers = localStorage.getItem(userAnswersKey);
            if (savedAnswers) {
                userAnswers = JSON.parse(savedAnswers);
                let answeredCount = 0;
                for (const qId in userAnswers) {
                    const questionCard = document.getElementById(`question-card-${qId}`);
                    if (questionCard) {
                        questionCard.classList.add('question-answered');
                        const input = document.querySelector(`input[name="question-${qId}"][value="${userAnswers[qId]}"]`);
                        if (input) {
                            input.checked = true;
                            input.closest('label').classList.add('option-selected');
                        }
                        answeredCount++;
                    }
                }
                document.getElementById('answered-count').innerText = answeredCount;
            } else {
                 userAnswers = {};
                 document.getElementById('answered-count').innerText = 0;
            }
            checkAllAnswered();
        }

        function saveProgress() {
            localStorage.setItem(userAnswersKey, JSON.stringify(userAnswers));
            document.getElementById('answered-count').innerText = Object.keys(userAnswers).length;
            checkAllAnswered();
        }

        function checkAllAnswered() {
            const allAnswered = Object.keys(userAnswers).length === quizData.length;
            document.getElementById('submit-btn').disabled = !allAnswered;
        }

        function submitQuiz() {
            let score = 0;
            quizData.forEach(q => {
                if (userAnswers[q.id] === q.answer) {
                    score++;
                }
            });

            document.getElementById('quiz-container').classList.add('hidden');
            document.getElementById('scorecard-container').classList.remove('hidden');
            document.getElementById('score').innerText = score;
            document.getElementById('total-questions-score').innerText = quizData.length;

            renderScorecard();
            renderScoreChart(score);
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function renderScorecard() {
            const detailsContainer = document.getElementById('scorecard-details');
            detailsContainer.innerHTML = '';
            quizData.forEach((q, index) => {
                const userAnswer = userAnswers[q.id];
                const isCorrect = userAnswer === q.answer;

                const questionResult = document.createElement('div');
                questionResult.className = `p-6 rounded-lg shadow-md transition-transform duration-300 transform hover:scale-[1.01] bg-white`;

                let optionsHTML = q.options.map((option, optIndex) => {
                    let classes = 'block mt-2 p-3 rounded-md';
                    if (option === q.answer) {
                        classes += ' bg-green-100 text-green-800 border border-green-400 font-bold';
                    } else if (option === userAnswer && !isCorrect) {
                        classes += ' bg-red-100 text-red-800 border border-red-400 font-bold';
                    } else {
                         classes += ' bg-gray-100 text-gray-800 border border-transparent';
                    }
                    return `<div class="${classes}">${alphabet[optIndex]}. ${option}</div>`;
                }).join('');

                questionResult.innerHTML = `
                    <p class="font-bold text-lg mb-4 text-[#132b3d]">${index + 1}. ${q.question}</p>
                    <div class="space-y-2">
                        ${optionsHTML}
                    </div>
                    <div class="mt-6 p-4 bg-gray-100 rounded-md">
                        <p class="font-bold text-[#132b3d] mb-1">Explanation:</p>
                        <p class="text-gray-700">${q.explanation}</p>
                    </div>
                `;
                detailsContainer.appendChild(questionResult);
            });
        }

        function renderScoreChart(score) {
            const ctx = document.getElementById('score-chart').getContext('2d');
            if (scoreChart) {
                scoreChart.destroy();
            }
            scoreChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Correct', 'Incorrect'],
                    datasets: [{
                        data: [score, quizData.length - score],
                        backgroundColor: ['#108289', '#f37e21'],
                        hoverOffset: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '70%',
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }

        document.addEventListener('DOMContentLoaded', () => {
            renderQuestions();
            document.getElementById('submit-btn').addEventListener('click', submitQuiz);
        });
    </script>
</body>
</html>
